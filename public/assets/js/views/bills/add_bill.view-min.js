function showItemSelectModal(){let t=$("#modal_select_bill_item");$("#btn_open_modal_add_item").on("click",function(){t.modal("show")})}function findItemById(t,e){for(let a=0;a<t.length;a++)if(t[a].id===e)return t[a];return null}function searchForItems(t,e){let a=$("#field_search_items");$("#btn_search_items").on("click",function(){let i=a.val().trim();$.get(`${getSiteUrl()}/items/search`,{keyword:i}).done(function(a){buildSearchResultsTableContent(a.data,t,e)}).fail(function(t){console.log(t.responseJSON.data)})})}function buildSearchResultsTableContent(t,e,a){e.rows().remove(),t.forEach(t=>{e.row.add([`<button class="btn btn-sm btn-primary btn_add_selected_item" data-id="${t.id}">Insert</button>`,t.item_name,t.description,t.category_name,t.gold_quality,t.weight,t.stock_price_string,t.quantity]).draw()}),addItemToTheBill(t,a)}function addItemToTheBill(t,e){$(".btn_add_selected_item").on("click",function(){let a=$(this).attr("data-id"),i=findItemById(t,a);null!=i&&(selectedItems.push(i),cleanToastContainer(),showSuccessToast(`${i.item_name} added successfully`),updateBillTable(e))})}function updateBillTable(t){function e(){let t=$(this).attr("data-id"),e=findItemById(selectedItems,t),a=$(`.field_item_quantity[data-id=${t}]`),i=$(`.field_item_price[data-id=${t}]`),l=$(`.field_subtotal[data-id=${t}]`),n=$("#btn_save_bill"),o=parseInt(a.val().toString()),s=parseFloat(i.val().toString());if(o>e.quantity||isNaN(o)||0===o)makeInputFieldInvalid(a),n.prop("disabled",!0),cleanToastContainer(),showWarningToast("Item quantity exceeded available quantity");else{makeInputFieldValid(a),n.prop("disabled",!1),cleanToastContainer();let e=o*s;l.val(e),chosenItems[t].quantity=o,chosenItems[t].price=s}}chosenItems={},t.rows().remove().draw(),selectedItems.forEach(e=>{t.row.add([e.item_name,`<input type="text" class="form-control form-control-sm text-right field_item_quantity" data-id="${e.id}" value="1">`,`<input type="text" class="form-control form-control-sm text-right field_item_price" data-id="${e.id}" placeholder="${e.stock_price}" value="${e.stock_price}">`,`<input type="text" class="form-control form-control-sm text-right field_subtotal" data-id="${e.id}" value="${e.stock_price}">`,`<button class="btn btn-sm btn-warning btn_remove_selected_item" data-id="${e.id}">Remove</button>`]).draw(),chosenItems[e.id]={id:e.id,quantity:e.quantity,price:e.stock_price}}),$(".btn_remove_selected_item").on("click",function(){let e=$(this).attr("data-id");selectedItems=selectedItems.filter(function(t){return t.id!==e}),cleanToastContainer(),showSuccessToast("Item removed"),updateBillTable(t)}),$(".field_item_quantity").on("keyup",e),$(".field_item_price").on("keyup",e)}function saveBill(){$("#btn_save_bill").on("click",function(){let t=$("#field_bill_date"),e=$("#field_customer_name"),a=$("#field_contact_number"),i=$("#field_address"),l=e.val().trim(),n=a.val().trim(),o=i.val().trim();cleanToastContainer(),resetInputFields($("#container_add_bill"));let s=!0;""===l&&(s=!1,makeInputFieldInvalid(e),showAlertToast("Invalid customer name")),""===n&&showInfoToast("Adding a contact number can be useful"),s&&$.post(`${getSiteUrl()}/bills/add-action`,{bill_date:t.val(),customer_name:l,contact_number:n,address:o,items:chosenItems}).done(function(t){console.log(t)}).fail(function(t){showAlertToast(t.responseJSON.data)})})}let selectedItems=[],chosenItems={};$(function(){let t=$("#dt_search_bill_items").DataTable({columnDefs:[{className:"text-right align-middle",targets:"_all"}],ordering:!0,order:[]}),e=$("#dt_bill_items").DataTable({columnDefs:[{className:"text-right align-middle",targets:"_all"}],ordering:!0,order:[]});showItemSelectModal(),searchForItems(t,e),saveBill()});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJpbGxzL2FkZF9iaWxsLnZpZXcuanMiXSwibmFtZXMiOlsic2hvd0l0ZW1TZWxlY3RNb2RhbCIsIm1vZGFsSXRlbVNlbGVjdCIsIiQiLCJvbiIsIm1vZGFsIiwiZmluZEl0ZW1CeUlkIiwiZGF0YSIsImlkIiwiaSIsImxlbmd0aCIsInNlYXJjaEZvckl0ZW1zIiwic2VhcmNoVGFibGUiLCJiaWxsVGFibGUiLCJmaWVsZFNlYXJjaCIsInR4dFNlYXJjaCIsInZhbCIsInRyaW0iLCJnZXQiLCJnZXRTaXRlVXJsIiwia2V5d29yZCIsImRvbmUiLCJyZXNwb25zZSIsImJ1aWxkU2VhcmNoUmVzdWx0c1RhYmxlQ29udGVudCIsImZhaWwiLCJjb25zb2xlIiwibG9nIiwicmVzcG9uc2VKU09OIiwicm93cyIsInJlbW92ZSIsImZvckVhY2giLCJpdGVtIiwicm93IiwiYWRkIiwiaXRlbV9uYW1lIiwiZGVzY3JpcHRpb24iLCJjYXRlZ29yeV9uYW1lIiwiZ29sZF9xdWFsaXR5Iiwid2VpZ2h0Iiwic3RvY2tfcHJpY2Vfc3RyaW5nIiwicXVhbnRpdHkiLCJkcmF3IiwiYWRkSXRlbVRvVGhlQmlsbCIsInRoaXMiLCJhdHRyIiwic2VsZWN0ZWRJdGVtIiwic2VsZWN0ZWRJdGVtcyIsInB1c2giLCJjbGVhblRvYXN0Q29udGFpbmVyIiwic2hvd1N1Y2Nlc3NUb2FzdCIsInVwZGF0ZUJpbGxUYWJsZSIsImNhbGN1bGF0ZVN1YnRvdGFsIiwiZmllbGRRdWFudGl0eSIsImZpZWxkUHJpY2UiLCJmaWVsZFN1YnRvdGFsIiwiYnRuU2F2ZUJpbGwiLCJ2YWx1ZVF1YW50aXR5IiwicGFyc2VJbnQiLCJ0b1N0cmluZyIsInZhbHVlUHJpY2UiLCJwYXJzZUZsb2F0IiwiaXNOYU4iLCJtYWtlSW5wdXRGaWVsZEludmFsaWQiLCJwcm9wIiwic2hvd1dhcm5pbmdUb2FzdCIsIm1ha2VJbnB1dEZpZWxkVmFsaWQiLCJzdWJ0b3RhbCIsImNob3Nlbkl0ZW1zIiwicHJpY2UiLCJzdG9ja19wcmljZSIsImZpbHRlciIsInZhbHVlIiwic2F2ZUJpbGwiLCJmaWVsZERhdGUiLCJmaWVsZEN1c3RvbWVyTmFtZSIsImZpZWxkQ29udGFjdE51bWJlciIsImZpZWxkQWRkcmVzcyIsInR4dEN1c3RvbWVyTmFtZSIsInR4dENvbnRhY3ROdW1iZXIiLCJ0eHRBZGRyZXNzIiwicmVzZXRJbnB1dEZpZWxkcyIsImlzVmFsaWQiLCJzaG93QWxlcnRUb2FzdCIsInNob3dJbmZvVG9hc3QiLCJwb3N0IiwiYmlsbF9kYXRlIiwiY3VzdG9tZXJfbmFtZSIsImNvbnRhY3RfbnVtYmVyIiwiYWRkcmVzcyIsIml0ZW1zIiwiZFRTZWFyY2hJdGVtcyIsIkRhdGFUYWJsZSIsImNvbHVtbkRlZnMiLCJjbGFzc05hbWUiLCJ0YXJnZXRzIiwib3JkZXJpbmciLCJvcmRlciIsImRUQmlsbEl0ZW1zIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxzQkFFTCxJQUFJQyxFQUFrQkMsRUFBRSwyQkFDS0EsRUFBRSw0QkFFUkMsR0FBRyxRQUFTLFdBQy9CRixFQUFnQkcsTUFBTSxVQU85QixTQUFTQyxhQUFhQyxFQUFNQyxHQUN4QixJQUFLLElBQUlDLEVBQUksRUFBR0EsRUFBSUYsRUFBS0csT0FBUUQsSUFDN0IsR0FBSUYsRUFBS0UsR0FBR0QsS0FBT0EsRUFDZixPQUFPRCxFQUFLRSxHQUVwQixPQUFPLEtBSVgsU0FBU0UsZUFBZUMsRUFBYUMsR0FFakMsSUFBSUMsRUFBY1gsRUFBRSx1QkFDSkEsRUFBRSxxQkFFUkMsR0FBRyxRQUFTLFdBRWxCLElBQUlXLEVBQVlELEVBQVlFLE1BQU1DLE9BRWxDZCxFQUFFZSxPQUFPQyw0QkFBNkIsQ0FDbENDLFFBQVNMLElBQ1ZNLEtBQUssU0FBVUMsR0FFZEMsK0JBQStCRCxFQUFTZixLQUFNSyxFQUFhQyxLQUU1RFcsS0FBSyxTQUFVRixHQUNkRyxRQUFRQyxJQUFJSixFQUFTSyxhQUFhcEIsVUFTOUMsU0FBU2dCLCtCQUErQmhCLEVBQU1LLEVBQWFDLEdBR3ZERCxFQUFZZ0IsT0FBT0MsU0FFbkJ0QixFQUFLdUIsUUFBUUMsSUFHVG5CLEVBQVlvQixJQUFJQyxJQUFJLDBFQUN5REYsRUFBS3ZCLHNCQUM5RXVCLEVBQUtHLFVBQ0xILEVBQUtJLFlBQ0xKLEVBQUtLLGNBQ0xMLEVBQUtNLGFBQ0xOLEVBQUtPLE9BQ0xQLEVBQUtRLG1CQUNMUixFQUFLUyxXQUNOQyxTQUlQQyxpQkFBaUJuQyxFQUFNTSxHQU0zQixTQUFTNkIsaUJBQWlCbkMsRUFBTU0sR0FDNUJWLEVBQUUsMEJBQTBCQyxHQUFHLFFBQVMsV0FFcEMsSUFBSUksRUFBS0wsRUFBRXdDLE1BQU1DLEtBQUssV0FFbEJDLEVBQWV2QyxhQUFhQyxFQUFNQyxHQUVsQixNQUFoQnFDLElBQ0FDLGNBQWNDLEtBQUtGLEdBRW5CRyxzQkFDQUMsb0JBQW9CSixFQUFhWCxnQ0FFakNnQixnQkFBZ0JyQyxNQVc1QixTQUFTcUMsZ0JBQWdCckMsR0FrRHJCLFNBQVNzQyxJQUVMLElBQUkzQyxFQUFLTCxFQUFFd0MsTUFBTUMsS0FBSyxXQUVsQmIsRUFBT3pCLGFBQWF3QyxjQUFldEMsR0FFbkM0QyxFQUFnQmpELGtDQUFrQ0ssTUFDbEQ2QyxFQUFhbEQsK0JBQStCSyxNQUM1QzhDLEVBQWdCbkQsNkJBQTZCSyxNQUU3QytDLEVBQWNwRCxFQUFFLGtCQUVoQnFELEVBQWdCQyxTQUFTTCxFQUFjcEMsTUFBTTBDLFlBQzdDQyxFQUFhQyxXQUFXUCxFQUFXckMsTUFBTTBDLFlBRTdDLEdBQUlGLEVBQWdCekIsRUFBS1MsVUFBWXFCLE1BQU1MLElBQW9DLElBQWxCQSxFQUV6RE0sc0JBQXNCVixHQUN0QkcsRUFBWVEsS0FBSyxZQUFZLEdBQzdCZixzQkFDQWdCLGlCQUFpQixpREFHZCxDQUNIQyxvQkFBb0JiLEdBRXBCRyxFQUFZUSxLQUFLLFlBQVksR0FDN0JmLHNCQUVBLElBQUlrQixFQUFXVixFQUFnQkcsRUFDL0JMLEVBQWN0QyxJQUFJa0QsR0FFbEJDLFlBQVkzRCxHQUFJZ0MsU0FBV2dCLEVBQzNCVyxZQUFZM0QsR0FBSTRELE1BQVFULEdBaEZoQ1EsWUFBYyxHQUdkdEQsRUFBVWUsT0FBT0MsU0FBU1ksT0FFMUJLLGNBQWNoQixRQUFRQyxJQUVsQmxCLEVBQVVtQixJQUFJQyxJQUFJLENBQ2RGLEVBQUtHLDZHQUM4RkgsRUFBS3ZCLGlIQUNSdUIsRUFBS3ZCLG9CQUFvQnVCLEVBQUtzQyx1QkFBdUJ0QyxFQUFLc0MsOEdBQzVEdEMsRUFBS3ZCLGNBQWN1QixFQUFLc0MsNEZBQzFDdEMsRUFBS3ZCLHdCQUNsRmlDLE9BRUgwQixZQUFZcEMsRUFBS3ZCLElBQU0sQ0FDbkJBLEdBQU11QixFQUFLdkIsR0FDWGdDLFNBQVlULEVBQUtTLFNBQ2pCNEIsTUFBU3JDLEVBQUtzQyxlQVV0QmxFLEVBQUUsNkJBQTZCQyxHQUFHLFFBQVMsV0FDdkMsSUFBSUksRUFBS0wsRUFBRXdDLE1BQU1DLEtBQUssV0FFdEJFLGNBQWdCQSxjQUFjd0IsT0FBTyxTQUFVQyxHQUMzQyxPQUFPQSxFQUFNL0QsS0FBT0EsSUFHeEJ3QyxzQkFDQUMsaUJBQWlCLGdCQUVqQkMsZ0JBQWdCckMsS0FpRHBCVixFQUFFLHdCQUF3QkMsR0FBRyxRQUFTK0MsR0FDdENoRCxFQUFFLHFCQUFxQkMsR0FBRyxRQUFTK0MsR0FNdkMsU0FBU3FCLFdBQ1NyRSxFQUFFLGtCQUdSQyxHQUFHLFFBQVMsV0FFaEIsSUFBSXFFLEVBQVl0RSxFQUFFLG9CQUNkdUUsRUFBb0J2RSxFQUFFLHdCQUN0QndFLEVBQXFCeEUsRUFBRSx5QkFDdkJ5RSxFQUFlekUsRUFBRSxrQkFFakIwRSxFQUFrQkgsRUFBa0IxRCxNQUFNQyxPQUMxQzZELEVBQW1CSCxFQUFtQjNELE1BQU1DLE9BQzVDOEQsRUFBYUgsRUFBYTVELE1BQU1DLE9BR3BDK0Isc0JBQ0FnQyxpQkFBaUI3RSxFQUFFLHdCQUduQixJQUFJOEUsR0FBVSxFQUVVLEtBQXBCSixJQUNBSSxHQUFVLEVBQ1ZuQixzQkFBc0JZLEdBQ3RCUSxlQUFlLDBCQUdNLEtBQXJCSixHQUNBSyxjQUFjLHlDQUdkRixHQUVBOUUsRUFBRWlGLFFBQVFqRSxnQ0FBaUMsQ0FDdkNrRSxVQUFhWixFQUFVekQsTUFDdkJzRSxjQUFpQlQsRUFDakJVLGVBQWtCVCxFQUNsQlUsUUFBV1QsRUFDWFUsTUFBU3RCLGNBQ1Y5QyxLQUFLLFNBQVVDLEdBRWRHLFFBQVFDLElBQUlKLEtBRWJFLEtBQUssU0FBVUYsR0FDZDRELGVBQWU1RCxFQUFTSyxhQUFhcEIsVUFVckQsSUFBSXVDLGNBQWdCLEdBQ2hCcUIsWUFBYyxHQUVsQmhFLEVBQUUsV0FFRSxJQUFJdUYsRUFBZ0J2RixFQUFFLHlCQUF5QndGLFVBQVUsQ0FDckRDLFdBQWMsQ0FDVixDQUFDQyxVQUFXLDBCQUEyQkMsUUFBVyxTQUV0REMsVUFBWSxFQUNaQyxNQUFTLEtBR1RDLEVBQWM5RixFQUFFLGtCQUFrQndGLFVBQVUsQ0FDNUNDLFdBQWMsQ0FDVixDQUFDQyxVQUFXLDBCQUEyQkMsUUFBVyxTQUV0REMsVUFBWSxFQUNaQyxNQUFTLEtBSWIvRixzQkFDQVUsZUFBZStFLEVBQWVPLEdBQzlCekIiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBzaG93SXRlbVNlbGVjdE1vZGFsKCkge1xyXG5cclxuICAgIGxldCBtb2RhbEl0ZW1TZWxlY3QgPSAkKFwiI21vZGFsX3NlbGVjdF9iaWxsX2l0ZW1cIik7XHJcbiAgICBsZXQgYnRuT3Blbk1vZGFsSXRlbVNlbGVjdCA9ICQoXCIjYnRuX29wZW5fbW9kYWxfYWRkX2l0ZW1cIik7XHJcblxyXG4gICAgYnRuT3Blbk1vZGFsSXRlbVNlbGVjdC5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBtb2RhbEl0ZW1TZWxlY3QubW9kYWwoXCJzaG93XCIpO1xyXG4gICAgfSk7XHJcblxyXG5cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGZpbmRJdGVtQnlJZChkYXRhLCBpZCkge1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKGRhdGFbaV0uaWQgPT09IGlkKVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YVtpXTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gc2VhcmNoRm9ySXRlbXMoc2VhcmNoVGFibGUsIGJpbGxUYWJsZSkge1xyXG5cclxuICAgIGxldCBmaWVsZFNlYXJjaCA9ICQoXCIjZmllbGRfc2VhcmNoX2l0ZW1zXCIpO1xyXG4gICAgbGV0IGJ0blNlYXJjaCA9ICQoXCIjYnRuX3NlYXJjaF9pdGVtc1wiKTtcclxuXHJcbiAgICBidG5TZWFyY2gub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgIGxldCB0eHRTZWFyY2ggPSBmaWVsZFNlYXJjaC52YWwoKS50cmltKCk7XHJcblxyXG4gICAgICAgICQuZ2V0KGAke2dldFNpdGVVcmwoKX0vaXRlbXMvc2VhcmNoYCwge1xyXG4gICAgICAgICAgICBrZXl3b3JkOiB0eHRTZWFyY2hcclxuICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgYnVpbGRTZWFyY2hSZXN1bHRzVGFibGVDb250ZW50KHJlc3BvbnNlLmRhdGEsIHNlYXJjaFRhYmxlLCBiaWxsVGFibGUpO1xyXG5cclxuICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5yZXNwb25zZUpTT04uZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIH0pO1xyXG5cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGJ1aWxkU2VhcmNoUmVzdWx0c1RhYmxlQ29udGVudChkYXRhLCBzZWFyY2hUYWJsZSwgYmlsbFRhYmxlKSB7XHJcblxyXG5cclxuICAgIHNlYXJjaFRhYmxlLnJvd3MoKS5yZW1vdmUoKTtcclxuXHJcbiAgICBkYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcblxyXG5cclxuICAgICAgICBzZWFyY2hUYWJsZS5yb3cuYWRkKFtcclxuICAgICAgICAgICAgYDxidXR0b24gY2xhc3M9XCJidG4gYnRuLXNtIGJ0bi1wcmltYXJ5IGJ0bl9hZGRfc2VsZWN0ZWRfaXRlbVwiIGRhdGEtaWQ9XCIke2l0ZW0uaWR9XCI+SW5zZXJ0PC9idXR0b24+YCxcclxuICAgICAgICAgICAgaXRlbS5pdGVtX25hbWUsXHJcbiAgICAgICAgICAgIGl0ZW0uZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIGl0ZW0uY2F0ZWdvcnlfbmFtZSxcclxuICAgICAgICAgICAgaXRlbS5nb2xkX3F1YWxpdHksXHJcbiAgICAgICAgICAgIGl0ZW0ud2VpZ2h0LFxyXG4gICAgICAgICAgICBpdGVtLnN0b2NrX3ByaWNlX3N0cmluZyxcclxuICAgICAgICAgICAgaXRlbS5xdWFudGl0eSxcclxuICAgICAgICBdKS5kcmF3KCk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgYWRkSXRlbVRvVGhlQmlsbChkYXRhLCBiaWxsVGFibGUpO1xyXG5cclxuXHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBhZGRJdGVtVG9UaGVCaWxsKGRhdGEsIGJpbGxUYWJsZSkge1xyXG4gICAgJChcIi5idG5fYWRkX3NlbGVjdGVkX2l0ZW1cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgIGxldCBpZCA9ICQodGhpcykuYXR0cignZGF0YS1pZCcpO1xyXG5cclxuICAgICAgICBsZXQgc2VsZWN0ZWRJdGVtID0gZmluZEl0ZW1CeUlkKGRhdGEsIGlkKTtcclxuXHJcbiAgICAgICAgaWYgKHNlbGVjdGVkSXRlbSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkSXRlbXMucHVzaChzZWxlY3RlZEl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgY2xlYW5Ub2FzdENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICBzaG93U3VjY2Vzc1RvYXN0KGAke3NlbGVjdGVkSXRlbS5pdGVtX25hbWV9IGFkZGVkIHN1Y2Nlc3NmdWxseWApO1xyXG5cclxuICAgICAgICAgICAgdXBkYXRlQmlsbFRhYmxlKGJpbGxUYWJsZSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqICBVcGRhdGUgdGhlIGJpbGxzIHRhYmxlIGFuZCBtYWtlIG1vZGlmaWNhdGlvbnMgYXMgdXNlciBwbGF5cyBhcm91bmRcclxuICogQHBhcmFtIGJpbGxUYWJsZVxyXG4gKi9cclxuZnVuY3Rpb24gdXBkYXRlQmlsbFRhYmxlKGJpbGxUYWJsZSkge1xyXG5cclxuXHJcbiAgICBjaG9zZW5JdGVtcyA9IHt9O1xyXG5cclxuICAgIC8vIHJlbW92ZSBhbGwgdGhlIGl0ZW1zIGZyb20gdGhlIHRhYmxlXHJcbiAgICBiaWxsVGFibGUucm93cygpLnJlbW92ZSgpLmRyYXcoKTtcclxuXHJcbiAgICBzZWxlY3RlZEl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcblxyXG4gICAgICAgIGJpbGxUYWJsZS5yb3cuYWRkKFtcclxuICAgICAgICAgICAgaXRlbS5pdGVtX25hbWUsXHJcbiAgICAgICAgICAgIGA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbCBmb3JtLWNvbnRyb2wtc20gdGV4dC1yaWdodCBmaWVsZF9pdGVtX3F1YW50aXR5XCIgZGF0YS1pZD1cIiR7aXRlbS5pZH1cIiB2YWx1ZT1cIjFcIj5gLFxyXG4gICAgICAgICAgICBgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2wgZm9ybS1jb250cm9sLXNtIHRleHQtcmlnaHQgZmllbGRfaXRlbV9wcmljZVwiIGRhdGEtaWQ9XCIke2l0ZW0uaWR9XCIgcGxhY2Vob2xkZXI9XCIke2l0ZW0uc3RvY2tfcHJpY2V9XCIgdmFsdWU9XCIke2l0ZW0uc3RvY2tfcHJpY2V9XCI+YCxcclxuICAgICAgICAgICAgYDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sIGZvcm0tY29udHJvbC1zbSB0ZXh0LXJpZ2h0IGZpZWxkX3N1YnRvdGFsXCIgZGF0YS1pZD1cIiR7aXRlbS5pZH1cIiB2YWx1ZT1cIiR7aXRlbS5zdG9ja19wcmljZX1cIj5gLFxyXG4gICAgICAgICAgICBgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tc20gYnRuLXdhcm5pbmcgYnRuX3JlbW92ZV9zZWxlY3RlZF9pdGVtXCIgZGF0YS1pZD1cIiR7aXRlbS5pZH1cIj5SZW1vdmU8L2J1dHRvbj5gXHJcbiAgICAgICAgXSkuZHJhdygpO1xyXG5cclxuICAgICAgICBjaG9zZW5JdGVtc1tpdGVtLmlkXSA9IHtcclxuICAgICAgICAgICAgXCJpZFwiOiBpdGVtLmlkLFxyXG4gICAgICAgICAgICBcInF1YW50aXR5XCI6IGl0ZW0ucXVhbnRpdHksXHJcbiAgICAgICAgICAgIFwicHJpY2VcIjogaXRlbS5zdG9ja19wcmljZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBMb2dpYyBmb3IgcmVtb3ZpbmcgYWRkZWQgaXRlbXMgZnJvbSB0aGUgYmlsbFxyXG4gICAgICovXHJcblxyXG4gICAgJChcIi5idG5fcmVtb3ZlX3NlbGVjdGVkX2l0ZW1cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbGV0IGlkID0gJCh0aGlzKS5hdHRyKCdkYXRhLWlkJyk7XHJcblxyXG4gICAgICAgIHNlbGVjdGVkSXRlbXMgPSBzZWxlY3RlZEl0ZW1zLmZpbHRlcihmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLmlkICE9PSBpZDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY2xlYW5Ub2FzdENvbnRhaW5lcigpO1xyXG4gICAgICAgIHNob3dTdWNjZXNzVG9hc3QoXCJJdGVtIHJlbW92ZWRcIik7XHJcblxyXG4gICAgICAgIHVwZGF0ZUJpbGxUYWJsZShiaWxsVGFibGUpO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogTG9naWMgZm9yIGNhbGN1bGF0aW5nIHN1YnRvdGFsIGZvciB0aGUgYWRkZWQgaXRlbXNcclxuICAgICAqIHN1YnRvdGFsID0gcXVhbnRpdHkgeCBwcmljZVxyXG4gICAgICovXHJcblxyXG4gICAgZnVuY3Rpb24gY2FsY3VsYXRlU3VidG90YWwoKSB7XHJcblxyXG4gICAgICAgIGxldCBpZCA9ICQodGhpcykuYXR0cihcImRhdGEtaWRcIik7XHJcblxyXG4gICAgICAgIGxldCBpdGVtID0gZmluZEl0ZW1CeUlkKHNlbGVjdGVkSXRlbXMsIGlkKTtcclxuXHJcbiAgICAgICAgbGV0IGZpZWxkUXVhbnRpdHkgPSAkKGAuZmllbGRfaXRlbV9xdWFudGl0eVtkYXRhLWlkPSR7aWR9XWApO1xyXG4gICAgICAgIGxldCBmaWVsZFByaWNlID0gJChgLmZpZWxkX2l0ZW1fcHJpY2VbZGF0YS1pZD0ke2lkfV1gKTtcclxuICAgICAgICBsZXQgZmllbGRTdWJ0b3RhbCA9ICQoYC5maWVsZF9zdWJ0b3RhbFtkYXRhLWlkPSR7aWR9XWApO1xyXG5cclxuICAgICAgICBsZXQgYnRuU2F2ZUJpbGwgPSAkKFwiI2J0bl9zYXZlX2JpbGxcIik7XHJcblxyXG4gICAgICAgIGxldCB2YWx1ZVF1YW50aXR5ID0gcGFyc2VJbnQoZmllbGRRdWFudGl0eS52YWwoKS50b1N0cmluZygpKTtcclxuICAgICAgICBsZXQgdmFsdWVQcmljZSA9IHBhcnNlRmxvYXQoZmllbGRQcmljZS52YWwoKS50b1N0cmluZygpKTtcclxuXHJcbiAgICAgICAgaWYgKHZhbHVlUXVhbnRpdHkgPiBpdGVtLnF1YW50aXR5IHx8IGlzTmFOKHZhbHVlUXVhbnRpdHkpIHx8IHZhbHVlUXVhbnRpdHkgPT09IDApIHtcclxuXHJcbiAgICAgICAgICAgIG1ha2VJbnB1dEZpZWxkSW52YWxpZChmaWVsZFF1YW50aXR5KTtcclxuICAgICAgICAgICAgYnRuU2F2ZUJpbGwucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xyXG4gICAgICAgICAgICBjbGVhblRvYXN0Q29udGFpbmVyKCk7XHJcbiAgICAgICAgICAgIHNob3dXYXJuaW5nVG9hc3QoXCJJdGVtIHF1YW50aXR5IGV4Y2VlZGVkIGF2YWlsYWJsZSBxdWFudGl0eVwiKTtcclxuXHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG1ha2VJbnB1dEZpZWxkVmFsaWQoZmllbGRRdWFudGl0eSk7XHJcblxyXG4gICAgICAgICAgICBidG5TYXZlQmlsbC5wcm9wKFwiZGlzYWJsZWRcIiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjbGVhblRvYXN0Q29udGFpbmVyKCk7XHJcblxyXG4gICAgICAgICAgICBsZXQgc3VidG90YWwgPSB2YWx1ZVF1YW50aXR5ICogdmFsdWVQcmljZTtcclxuICAgICAgICAgICAgZmllbGRTdWJ0b3RhbC52YWwoc3VidG90YWwpO1xyXG5cclxuICAgICAgICAgICAgY2hvc2VuSXRlbXNbaWRdLnF1YW50aXR5ID0gdmFsdWVRdWFudGl0eTtcclxuICAgICAgICAgICAgY2hvc2VuSXRlbXNbaWRdLnByaWNlID0gdmFsdWVQcmljZTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgJChcIi5maWVsZF9pdGVtX3F1YW50aXR5XCIpLm9uKFwia2V5dXBcIiwgY2FsY3VsYXRlU3VidG90YWwpO1xyXG4gICAgJChcIi5maWVsZF9pdGVtX3ByaWNlXCIpLm9uKFwia2V5dXBcIiwgY2FsY3VsYXRlU3VidG90YWwpO1xyXG5cclxuXHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBzYXZlQmlsbCgpIHtcclxuICAgIGxldCBidG5TYXZlID0gJChcIiNidG5fc2F2ZV9iaWxsXCIpO1xyXG5cclxuXHJcbiAgICBidG5TYXZlLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICBsZXQgZmllbGREYXRlID0gJChcIiNmaWVsZF9iaWxsX2RhdGVcIik7XHJcbiAgICAgICAgbGV0IGZpZWxkQ3VzdG9tZXJOYW1lID0gJChcIiNmaWVsZF9jdXN0b21lcl9uYW1lXCIpO1xyXG4gICAgICAgIGxldCBmaWVsZENvbnRhY3ROdW1iZXIgPSAkKFwiI2ZpZWxkX2NvbnRhY3RfbnVtYmVyXCIpO1xyXG4gICAgICAgIGxldCBmaWVsZEFkZHJlc3MgPSAkKFwiI2ZpZWxkX2FkZHJlc3NcIik7XHJcblxyXG4gICAgICAgIGxldCB0eHRDdXN0b21lck5hbWUgPSBmaWVsZEN1c3RvbWVyTmFtZS52YWwoKS50cmltKCk7XHJcbiAgICAgICAgbGV0IHR4dENvbnRhY3ROdW1iZXIgPSBmaWVsZENvbnRhY3ROdW1iZXIudmFsKCkudHJpbSgpO1xyXG4gICAgICAgIGxldCB0eHRBZGRyZXNzID0gZmllbGRBZGRyZXNzLnZhbCgpLnRyaW0oKTtcclxuXHJcblxyXG4gICAgICAgIGNsZWFuVG9hc3RDb250YWluZXIoKTtcclxuICAgICAgICByZXNldElucHV0RmllbGRzKCQoXCIjY29udGFpbmVyX2FkZF9iaWxsXCIpKTtcclxuXHJcblxyXG4gICAgICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKHR4dEN1c3RvbWVyTmFtZSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICBpc1ZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIG1ha2VJbnB1dEZpZWxkSW52YWxpZChmaWVsZEN1c3RvbWVyTmFtZSk7XHJcbiAgICAgICAgICAgIHNob3dBbGVydFRvYXN0KFwiSW52YWxpZCBjdXN0b21lciBuYW1lXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR4dENvbnRhY3ROdW1iZXIgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgc2hvd0luZm9Ub2FzdChcIkFkZGluZyBhIGNvbnRhY3QgbnVtYmVyIGNhbiBiZSB1c2VmdWxcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaXNWYWxpZCkge1xyXG5cclxuICAgICAgICAgICAgJC5wb3N0KGAke2dldFNpdGVVcmwoKX0vYmlsbHMvYWRkLWFjdGlvbmAsIHtcclxuICAgICAgICAgICAgICAgIFwiYmlsbF9kYXRlXCI6IGZpZWxkRGF0ZS52YWwoKSxcclxuICAgICAgICAgICAgICAgIFwiY3VzdG9tZXJfbmFtZVwiOiB0eHRDdXN0b21lck5hbWUsXHJcbiAgICAgICAgICAgICAgICBcImNvbnRhY3RfbnVtYmVyXCI6IHR4dENvbnRhY3ROdW1iZXIsXHJcbiAgICAgICAgICAgICAgICBcImFkZHJlc3NcIjogdHh0QWRkcmVzcyxcclxuICAgICAgICAgICAgICAgIFwiaXRlbXNcIjogY2hvc2VuSXRlbXNcclxuICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc2hvd0FsZXJ0VG9hc3QocmVzcG9uc2UucmVzcG9uc2VKU09OLmRhdGEpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxufVxyXG5cclxuXHJcbmxldCBzZWxlY3RlZEl0ZW1zID0gW107XHJcbmxldCBjaG9zZW5JdGVtcyA9IHt9O1xyXG5cclxuJChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgbGV0IGRUU2VhcmNoSXRlbXMgPSAkKFwiI2R0X3NlYXJjaF9iaWxsX2l0ZW1zXCIpLkRhdGFUYWJsZSh7XHJcbiAgICAgICAgXCJjb2x1bW5EZWZzXCI6IFtcclxuICAgICAgICAgICAge2NsYXNzTmFtZTogXCJ0ZXh0LXJpZ2h0IGFsaWduLW1pZGRsZVwiLCBcInRhcmdldHNcIjogXCJfYWxsXCJ9XHJcbiAgICAgICAgXSxcclxuICAgICAgICBcIm9yZGVyaW5nXCI6IHRydWUsXHJcbiAgICAgICAgXCJvcmRlclwiOiBbXVxyXG4gICAgfSk7XHJcblxyXG4gICAgbGV0IGRUQmlsbEl0ZW1zID0gJChcIiNkdF9iaWxsX2l0ZW1zXCIpLkRhdGFUYWJsZSh7XHJcbiAgICAgICAgXCJjb2x1bW5EZWZzXCI6IFtcclxuICAgICAgICAgICAge2NsYXNzTmFtZTogXCJ0ZXh0LXJpZ2h0IGFsaWduLW1pZGRsZVwiLCBcInRhcmdldHNcIjogXCJfYWxsXCJ9XHJcbiAgICAgICAgXSxcclxuICAgICAgICBcIm9yZGVyaW5nXCI6IHRydWUsXHJcbiAgICAgICAgXCJvcmRlclwiOiBbXVxyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIHNob3dJdGVtU2VsZWN0TW9kYWwoKTtcclxuICAgIHNlYXJjaEZvckl0ZW1zKGRUU2VhcmNoSXRlbXMsIGRUQmlsbEl0ZW1zKTtcclxuICAgIHNhdmVCaWxsKCk7XHJcbn0pOyJdfQ==
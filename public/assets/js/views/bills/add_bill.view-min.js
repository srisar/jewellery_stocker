function showItemSelectModal(){let t=$("#modal_select_bill_item");$("#btn_open_modal_add_item").on("click",function(){t.modal("show")})}function findItemById(t,e){for(let a=0;a<t.length;a++)if(t[a].id===e)return t[a];return null}function searchForItems(t,e){let a=$("#field_search_items");$("#btn_search_items").on("click",function(){let i=a.val().trim();$.get(`${getSiteUrl()}/items/search`,{keyword:i}).done(function(a){buildSearchResultsTableContent(a.data,t,e)}).fail(function(t){console.log(t.responseJSON.data)})})}function buildSearchResultsTableContent(t,e,a){e.rows().remove(),t.forEach(t=>{e.row.add([`<button class="btn btn-sm btn-primary btn_add_selected_item" data-id="${t.id}">Insert</button>`,t.item_name,t.description,t.category_name,t.gold_quality,t.weight,t.stock_price_string,t.quantity]).draw()}),addItemToTheBill(t,a)}function addItemToTheBill(t,e){$(".btn_add_selected_item").on("click",function(){let a=$(this).attr("data-id"),i=findItemById(t,a);null!=i&&(selectedItems.push(i),cleanToastContainer(),showSuccessToast(`${i.item_name} added successfully`),updateBillTable(e))})}function updateBillTable(t){function e(){let t=$(this).attr("data-id"),e=findItemById(selectedItems,t),a=$(`.field_item_quantity[data-id=${t}]`),i=$(`.field_item_price[data-id=${t}]`),l=$(`.field_subtotal[data-id=${t}]`),n=$("#btn_save_bill"),o=parseInt(a.val().toString()),s=parseFloat(i.val().toString());if(o>e.quantity||isNaN(o)||0===o)makeInputFieldInvalid(a),n.prop("disabled",!0),cleanToastContainer(),showWarningToast("Item quantity exceeded available quantity");else{makeInputFieldValid(a),n.prop("disabled",!1),cleanToastContainer();let e=o*s;l.val(e),chosenItems[t].quantity=o,chosenItems[t].price=s}}chosenItems={},t.rows().remove().draw(),selectedItems.forEach(e=>{t.row.add([e.item_name,`<input type="text" class="form-control form-control-sm text-right field_item_quantity" data-id="${e.id}" value="1">`,`<input type="text" class="form-control form-control-sm text-right field_item_price" data-id="${e.id}" placeholder="${e.stock_price}" value="${e.stock_price}">`,`<input type="text" class="form-control form-control-sm text-right field_subtotal" data-id="${e.id}" value="${e.stock_price}">`,`<button class="btn btn-sm btn-warning btn_remove_selected_item" data-id="${e.id}">Remove</button>`]).draw(),chosenItems[e.id]={id:e.id,quantity:1,price:e.stock_price}}),$(".btn_remove_selected_item").on("click",function(){let e=$(this).attr("data-id");selectedItems=selectedItems.filter(function(t){return t.id!==e}),cleanToastContainer(),showSuccessToast("Item removed"),updateBillTable(t)}),$(".field_item_quantity").on("keyup",e),$(".field_item_price").on("keyup",e)}function saveBill(){$("#btn_save_bill").on("click",function(){let t=$("#field_bill_date"),e=$("#field_customer_name"),a=$("#field_contact_number"),i=$("#field_address"),l=e.val().trim(),n=a.val().trim(),o=i.val().trim();cleanToastContainer(),resetInputFields($("#container_add_bill"));let s=!0;""===l&&(s=!1,makeInputFieldInvalid(e),showAlertToast("Invalid customer name")),""===n&&showInfoToast("Adding a contact number can be useful"),s&&$.post(`${getSiteUrl()}/bills/add-action`,{bill_date:t.val(),customer_name:l,contact_number:n,address:o,items:chosenItems}).done(function(t){console.log(t)}).fail(function(t){showAlertToast(t.responseJSON.data)})})}let selectedItems=[],chosenItems={};$(function(){let t=$("#dt_search_bill_items").DataTable({columnDefs:[{className:"text-right align-middle",targets:"_all"}],ordering:!0,order:[]}),e=$("#dt_bill_items").DataTable({columnDefs:[{className:"text-right align-middle",targets:"_all"}],ordering:!0,order:[]});showItemSelectModal(),searchForItems(t,e),saveBill()});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJpbGxzL2FkZF9iaWxsLnZpZXcuanMiXSwibmFtZXMiOlsic2hvd0l0ZW1TZWxlY3RNb2RhbCIsIm1vZGFsSXRlbVNlbGVjdCIsIiQiLCJvbiIsIm1vZGFsIiwiZmluZEl0ZW1CeUlkIiwiZGF0YSIsImlkIiwiaSIsImxlbmd0aCIsInNlYXJjaEZvckl0ZW1zIiwic2VhcmNoVGFibGUiLCJiaWxsVGFibGUiLCJmaWVsZFNlYXJjaCIsInR4dFNlYXJjaCIsInZhbCIsInRyaW0iLCJnZXQiLCJnZXRTaXRlVXJsIiwia2V5d29yZCIsImRvbmUiLCJyZXNwb25zZSIsImJ1aWxkU2VhcmNoUmVzdWx0c1RhYmxlQ29udGVudCIsImZhaWwiLCJjb25zb2xlIiwibG9nIiwicmVzcG9uc2VKU09OIiwicm93cyIsInJlbW92ZSIsImZvckVhY2giLCJpdGVtIiwicm93IiwiYWRkIiwiaXRlbV9uYW1lIiwiZGVzY3JpcHRpb24iLCJjYXRlZ29yeV9uYW1lIiwiZ29sZF9xdWFsaXR5Iiwid2VpZ2h0Iiwic3RvY2tfcHJpY2Vfc3RyaW5nIiwicXVhbnRpdHkiLCJkcmF3IiwiYWRkSXRlbVRvVGhlQmlsbCIsInRoaXMiLCJhdHRyIiwic2VsZWN0ZWRJdGVtIiwic2VsZWN0ZWRJdGVtcyIsInB1c2giLCJjbGVhblRvYXN0Q29udGFpbmVyIiwic2hvd1N1Y2Nlc3NUb2FzdCIsInVwZGF0ZUJpbGxUYWJsZSIsImNhbGN1bGF0ZVN1YnRvdGFsIiwiZmllbGRRdWFudGl0eSIsImZpZWxkUHJpY2UiLCJmaWVsZFN1YnRvdGFsIiwiYnRuU2F2ZUJpbGwiLCJ2YWx1ZVF1YW50aXR5IiwicGFyc2VJbnQiLCJ0b1N0cmluZyIsInZhbHVlUHJpY2UiLCJwYXJzZUZsb2F0IiwiaXNOYU4iLCJtYWtlSW5wdXRGaWVsZEludmFsaWQiLCJwcm9wIiwic2hvd1dhcm5pbmdUb2FzdCIsIm1ha2VJbnB1dEZpZWxkVmFsaWQiLCJzdWJ0b3RhbCIsImNob3Nlbkl0ZW1zIiwicHJpY2UiLCJzdG9ja19wcmljZSIsImZpbHRlciIsInZhbHVlIiwic2F2ZUJpbGwiLCJmaWVsZERhdGUiLCJmaWVsZEN1c3RvbWVyTmFtZSIsImZpZWxkQ29udGFjdE51bWJlciIsImZpZWxkQWRkcmVzcyIsInR4dEN1c3RvbWVyTmFtZSIsInR4dENvbnRhY3ROdW1iZXIiLCJ0eHRBZGRyZXNzIiwicmVzZXRJbnB1dEZpZWxkcyIsImlzVmFsaWQiLCJzaG93QWxlcnRUb2FzdCIsInNob3dJbmZvVG9hc3QiLCJwb3N0IiwiYmlsbF9kYXRlIiwiY3VzdG9tZXJfbmFtZSIsImNvbnRhY3RfbnVtYmVyIiwiYWRkcmVzcyIsIml0ZW1zIiwiZFRTZWFyY2hJdGVtcyIsIkRhdGFUYWJsZSIsImNvbHVtbkRlZnMiLCJjbGFzc05hbWUiLCJ0YXJnZXRzIiwib3JkZXJpbmciLCJvcmRlciIsImRUQmlsbEl0ZW1zIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxzQkFFTCxJQUFJQyxFQUFrQkMsRUFBRSwyQkFDS0EsRUFBRSw0QkFFUkMsR0FBRyxRQUFTLFdBQy9CRixFQUFnQkcsTUFBTSxVQU85QixTQUFTQyxhQUFhQyxFQUFNQyxHQUN4QixJQUFLLElBQUlDLEVBQUksRUFBR0EsRUFBSUYsRUFBS0csT0FBUUQsSUFDN0IsR0FBSUYsRUFBS0UsR0FBR0QsS0FBT0EsRUFDZixPQUFPRCxFQUFLRSxHQUVwQixPQUFPLEtBSVgsU0FBU0UsZUFBZUMsRUFBYUMsR0FFakMsSUFBSUMsRUFBY1gsRUFBRSx1QkFDSkEsRUFBRSxxQkFFUkMsR0FBRyxRQUFTLFdBRWxCLElBQUlXLEVBQVlELEVBQVlFLE1BQU1DLE9BRWxDZCxFQUFFZSxPQUFPQyw0QkFBNkIsQ0FDbENDLFFBQVNMLElBQ1ZNLEtBQUssU0FBVUMsR0FFZEMsK0JBQStCRCxFQUFTZixLQUFNSyxFQUFhQyxLQUU1RFcsS0FBSyxTQUFVRixHQUNkRyxRQUFRQyxJQUFJSixFQUFTSyxhQUFhcEIsVUFTOUMsU0FBU2dCLCtCQUErQmhCLEVBQU1LLEVBQWFDLEdBR3ZERCxFQUFZZ0IsT0FBT0Ms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a0UsVUFBYVosRUFBVXpELE1BQ3ZCc0UsY0FBaUJULEVBQ2pCVSxlQUFrQlQsRUFDbEJVLFFBQVdULEVBQ1hVLE1BQVN0QixjQUNWOUMsS0FBSyxTQUFVQyxHQUVkRyxRQUFRQyxJQUFJSixLQUViRSxLQUFLLFNBQVVGLEdBQ2Q0RCxlQUFlNUQsRUFBU0ssYUFBYXBCLFVBVXJELElBQUl1QyxjQUFnQixHQUNoQnFCLFlBQWMsR0FFbEJoRSxFQUFFLFdBRUUsSUFBSXVGLEVBQWdCdkYsRUFBRSx5QkFBeUJ3RixVQUFVLENBQ3JEQyxXQUFjLENBQ1YsQ0FBQ0MsVUFBVywwQkFBMkJDLFFBQVcsU0FFdERDLFVBQVksRUFDWkMsTUFBUyxLQUdUQyxFQUFjOUYsRUFBRSxrQkFBa0J3RixVQUFVLENBQzVDQyxXQUFjLENBQ1YsQ0FBQ0MsVUFBVywwQkFBMkJDLFFBQVcsU0FFdERDLFVBQVksRUFDWkMsTUFBUyxLQUliL0Ysc0JBQ0FVLGVBQWUrRSxFQUFlTyxHQUM5QnpCIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gc2hvd0l0ZW1TZWxlY3RNb2RhbCgpIHtcclxuXHJcbiAgICBsZXQgbW9kYWxJdGVtU2VsZWN0ID0gJChcIiNtb2RhbF9zZWxlY3RfYmlsbF9pdGVtXCIpO1xyXG4gICAgbGV0IGJ0bk9wZW5Nb2RhbEl0ZW1TZWxlY3QgPSAkKFwiI2J0bl9vcGVuX21vZGFsX2FkZF9pdGVtXCIpO1xyXG5cclxuICAgIGJ0bk9wZW5Nb2RhbEl0ZW1TZWxlY3Qub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbW9kYWxJdGVtU2VsZWN0Lm1vZGFsKFwic2hvd1wiKTtcclxuICAgIH0pO1xyXG5cclxuXHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBmaW5kSXRlbUJ5SWQoZGF0YSwgaWQpIHtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChkYXRhW2ldLmlkID09PSBpZClcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFbaV07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIHNlYXJjaEZvckl0ZW1zKHNlYXJjaFRhYmxlLCBiaWxsVGFibGUpIHtcclxuXHJcbiAgICBsZXQgZmllbGRTZWFyY2ggPSAkKFwiI2ZpZWxkX3NlYXJjaF9pdGVtc1wiKTtcclxuICAgIGxldCBidG5TZWFyY2ggPSAkKFwiI2J0bl9zZWFyY2hfaXRlbXNcIik7XHJcblxyXG4gICAgYnRuU2VhcmNoLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICBsZXQgdHh0U2VhcmNoID0gZmllbGRTZWFyY2gudmFsKCkudHJpbSgpO1xyXG5cclxuICAgICAgICAkLmdldChgJHtnZXRTaXRlVXJsKCl9L2l0ZW1zL3NlYXJjaGAsIHtcclxuICAgICAgICAgICAga2V5d29yZDogdHh0U2VhcmNoXHJcbiAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgIGJ1aWxkU2VhcmNoUmVzdWx0c1RhYmxlQ29udGVudChyZXNwb25zZS5kYXRhLCBzZWFyY2hUYWJsZSwgYmlsbFRhYmxlKTtcclxuXHJcbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UucmVzcG9uc2VKU09OLmRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICB9KTtcclxuXHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBidWlsZFNlYXJjaFJlc3VsdHNUYWJsZUNvbnRlbnQoZGF0YSwgc2VhcmNoVGFibGUsIGJpbGxUYWJsZSkge1xyXG5cclxuXHJcbiAgICBzZWFyY2hUYWJsZS5yb3dzKCkucmVtb3ZlKCk7XHJcblxyXG4gICAgZGF0YS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG5cclxuXHJcbiAgICAgICAgc2VhcmNoVGFibGUucm93LmFkZChbXHJcbiAgICAgICAgICAgIGA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1zbSBidG4tcHJpbWFyeSBidG5fYWRkX3NlbGVjdGVkX2l0ZW1cIiBkYXRhLWlkPVwiJHtpdGVtLmlkfVwiPkluc2VydDwvYnV0dG9uPmAsXHJcbiAgICAgICAgICAgIGl0ZW0uaXRlbV9uYW1lLFxyXG4gICAgICAgICAgICBpdGVtLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICBpdGVtLmNhdGVnb3J5X25hbWUsXHJcbiAgICAgICAgICAgIGl0ZW0uZ29sZF9xdWFsaXR5LFxyXG4gICAgICAgICAgICBpdGVtLndlaWdodCxcclxuICAgICAgICAgICAgaXRlbS5zdG9ja19wcmljZV9zdHJpbmcsXHJcbiAgICAgICAgICAgIGl0ZW0ucXVhbnRpdHksXHJcbiAgICAgICAgXSkuZHJhdygpO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIGFkZEl0ZW1Ub1RoZUJpbGwoZGF0YSwgYmlsbFRhYmxlKTtcclxuXHJcblxyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gYWRkSXRlbVRvVGhlQmlsbChkYXRhLCBiaWxsVGFibGUpIHtcclxuICAgICQoXCIuYnRuX2FkZF9zZWxlY3RlZF9pdGVtXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICBsZXQgaWQgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKTtcclxuXHJcbiAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IGZpbmRJdGVtQnlJZChkYXRhLCBpZCk7XHJcblxyXG4gICAgICAgIGlmIChzZWxlY3RlZEl0ZW0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBzZWxlY3RlZEl0ZW1zLnB1c2goc2VsZWN0ZWRJdGVtKTtcclxuXHJcbiAgICAgICAgICAgIGNsZWFuVG9hc3RDb250YWluZXIoKTtcclxuICAgICAgICAgICAgc2hvd1N1Y2Nlc3NUb2FzdChgJHtzZWxlY3RlZEl0ZW0uaXRlbV9uYW1lfSBhZGRlZCBzdWNjZXNzZnVsbHlgKTtcclxuXHJcbiAgICAgICAgICAgIHVwZGF0ZUJpbGxUYWJsZShiaWxsVGFibGUpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiAgVXBkYXRlIHRoZSBiaWxscyB0YWJsZSBhbmQgbWFrZSBtb2RpZmljYXRpb25zIGFzIHVzZXIgcGxheXMgYXJvdW5kXHJcbiAqIEBwYXJhbSBiaWxsVGFibGVcclxuICovXHJcbmZ1bmN0aW9uIHVwZGF0ZUJpbGxUYWJsZShiaWxsVGFibGUpIHtcclxuXHJcblxyXG4gICAgY2hvc2VuSXRlbXMgPSB7fTtcclxuXHJcbiAgICAvLyByZW1vdmUgYWxsIHRoZSBpdGVtcyBmcm9tIHRoZSB0YWJsZVxyXG4gICAgYmlsbFRhYmxlLnJvd3MoKS5yZW1vdmUoKS5kcmF3KCk7XHJcblxyXG4gICAgc2VsZWN0ZWRJdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG5cclxuICAgICAgICBiaWxsVGFibGUucm93LmFkZChbXHJcbiAgICAgICAgICAgIGl0ZW0uaXRlbV9uYW1lLFxyXG4gICAgICAgICAgICBgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2wgZm9ybS1jb250cm9sLXNtIHRleHQtcmlnaHQgZmllbGRfaXRlbV9xdWFudGl0eVwiIGRhdGEtaWQ9XCIke2l0ZW0uaWR9XCIgdmFsdWU9XCIxXCI+YCxcclxuICAgICAgICAgICAgYDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sIGZvcm0tY29udHJvbC1zbSB0ZXh0LXJpZ2h0IGZpZWxkX2l0ZW1fcHJpY2VcIiBkYXRhLWlkPVwiJHtpdGVtLmlkfVwiIHBsYWNlaG9sZGVyPVwiJHtpdGVtLnN0b2NrX3ByaWNlfVwiIHZhbHVlPVwiJHtpdGVtLnN0b2NrX3ByaWNlfVwiPmAsXHJcbiAgICAgICAgICAgIGA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbCBmb3JtLWNvbnRyb2wtc20gdGV4dC1yaWdodCBmaWVsZF9zdWJ0b3RhbFwiIGRhdGEtaWQ9XCIke2l0ZW0uaWR9XCIgdmFsdWU9XCIke2l0ZW0uc3RvY2tfcHJpY2V9XCI+YCxcclxuICAgICAgICAgICAgYDxidXR0b24gY2xhc3M9XCJidG4gYnRuLXNtIGJ0bi13YXJuaW5nIGJ0bl9yZW1vdmVfc2VsZWN0ZWRfaXRlbVwiIGRhdGEtaWQ9XCIke2l0ZW0uaWR9XCI+UmVtb3ZlPC9idXR0b24+YFxyXG4gICAgICAgIF0pLmRyYXcoKTtcclxuXHJcbiAgICAgICAgY2hvc2VuSXRlbXNbaXRlbS5pZF0gPSB7XHJcbiAgICAgICAgICAgIFwiaWRcIjogaXRlbS5pZCxcclxuICAgICAgICAgICAgXCJxdWFudGl0eVwiOiAxLFxyXG4gICAgICAgICAgICBcInByaWNlXCI6IGl0ZW0uc3RvY2tfcHJpY2VcclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTG9naWMgZm9yIHJlbW92aW5nIGFkZGVkIGl0ZW1zIGZyb20gdGhlIGJpbGxcclxuICAgICAqL1xyXG5cclxuICAgICQoXCIuYnRuX3JlbW92ZV9zZWxlY3RlZF9pdGVtXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxldCBpZCA9ICQodGhpcykuYXR0cignZGF0YS1pZCcpO1xyXG5cclxuICAgICAgICBzZWxlY3RlZEl0ZW1zID0gc2VsZWN0ZWRJdGVtcy5maWx0ZXIoZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5pZCAhPT0gaWQ7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNsZWFuVG9hc3RDb250YWluZXIoKTtcclxuICAgICAgICBzaG93U3VjY2Vzc1RvYXN0KFwiSXRlbSByZW1vdmVkXCIpO1xyXG5cclxuICAgICAgICB1cGRhdGVCaWxsVGFibGUoYmlsbFRhYmxlKTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIExvZ2ljIGZvciBjYWxjdWxhdGluZyBzdWJ0b3RhbCBmb3IgdGhlIGFkZGVkIGl0ZW1zXHJcbiAgICAgKiBzdWJ0b3RhbCA9IHF1YW50aXR5IHggcHJpY2VcclxuICAgICAqL1xyXG5cclxuICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVN1YnRvdGFsKCkge1xyXG5cclxuICAgICAgICBsZXQgaWQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWlkXCIpO1xyXG5cclxuICAgICAgICBsZXQgaXRlbSA9IGZpbmRJdGVtQnlJZChzZWxlY3RlZEl0ZW1zLCBpZCk7XHJcblxyXG4gICAgICAgIGxldCBmaWVsZFF1YW50aXR5ID0gJChgLmZpZWxkX2l0ZW1fcXVhbnRpdHlbZGF0YS1pZD0ke2lkfV1gKTtcclxuICAgICAgICBsZXQgZmllbGRQcmljZSA9ICQoYC5maWVsZF9pdGVtX3ByaWNlW2RhdGEtaWQ9JHtpZH1dYCk7XHJcbiAgICAgICAgbGV0IGZpZWxkU3VidG90YWwgPSAkKGAuZmllbGRfc3VidG90YWxbZGF0YS1pZD0ke2lkfV1gKTtcclxuXHJcbiAgICAgICAgbGV0IGJ0blNhdmVCaWxsID0gJChcIiNidG5fc2F2ZV9iaWxsXCIpO1xyXG5cclxuICAgICAgICBsZXQgdmFsdWVRdWFudGl0eSA9IHBhcnNlSW50KGZpZWxkUXVhbnRpdHkudmFsKCkudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgbGV0IHZhbHVlUHJpY2UgPSBwYXJzZUZsb2F0KGZpZWxkUHJpY2UudmFsKCkudG9TdHJpbmcoKSk7XHJcblxyXG4gICAgICAgIGlmICh2YWx1ZVF1YW50aXR5ID4gaXRlbS5xdWFudGl0eSB8fCBpc05hTih2YWx1ZVF1YW50aXR5KSB8fCB2YWx1ZVF1YW50aXR5ID09PSAwKSB7XHJcblxyXG4gICAgICAgICAgICBtYWtlSW5wdXRGaWVsZEludmFsaWQoZmllbGRRdWFudGl0eSk7XHJcbiAgICAgICAgICAgIGJ0blNhdmVCaWxsLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxuICAgICAgICAgICAgY2xlYW5Ub2FzdENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICBzaG93V2FybmluZ1RvYXN0KFwiSXRlbSBxdWFudGl0eSBleGNlZWRlZCBhdmFpbGFibGUgcXVhbnRpdHlcIik7XHJcblxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBtYWtlSW5wdXRGaWVsZFZhbGlkKGZpZWxkUXVhbnRpdHkpO1xyXG5cclxuICAgICAgICAgICAgYnRuU2F2ZUJpbGwucHJvcChcImRpc2FibGVkXCIsIGZhbHNlKTtcclxuICAgICAgICAgICAgY2xlYW5Ub2FzdENvbnRhaW5lcigpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHN1YnRvdGFsID0gdmFsdWVRdWFudGl0eSAqIHZhbHVlUHJpY2U7XHJcbiAgICAgICAgICAgIGZpZWxkU3VidG90YWwudmFsKHN1YnRvdGFsKTtcclxuXHJcbiAgICAgICAgICAgIGNob3Nlbkl0ZW1zW2lkXS5xdWFudGl0eSA9IHZhbHVlUXVhbnRpdHk7XHJcbiAgICAgICAgICAgIGNob3Nlbkl0ZW1zW2lkXS5wcmljZSA9IHZhbHVlUHJpY2U7XHJcblxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgfVxyXG5cclxuICAgICQoXCIuZmllbGRfaXRlbV9xdWFudGl0eVwiKS5vbihcImtleXVwXCIsIGNhbGN1bGF0ZVN1YnRvdGFsKTtcclxuICAgICQoXCIuZmllbGRfaXRlbV9wcmljZVwiKS5vbihcImtleXVwXCIsIGNhbGN1bGF0ZVN1YnRvdGFsKTtcclxuXHJcblxyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gc2F2ZUJpbGwoKSB7XHJcbiAgICBsZXQgYnRuU2F2ZSA9ICQoXCIjYnRuX3NhdmVfYmlsbFwiKTtcclxuXHJcblxyXG4gICAgYnRuU2F2ZS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgbGV0IGZpZWxkRGF0ZSA9ICQoXCIjZmllbGRfYmlsbF9kYXRlXCIpO1xyXG4gICAgICAgIGxldCBmaWVsZEN1c3RvbWVyTmFtZSA9ICQoXCIjZmllbGRfY3VzdG9tZXJfbmFtZVwiKTtcclxuICAgICAgICBsZXQgZmllbGRDb250YWN0TnVtYmVyID0gJChcIiNmaWVsZF9jb250YWN0X251bWJlclwiKTtcclxuICAgICAgICBsZXQgZmllbGRBZGRyZXNzID0gJChcIiNmaWVsZF9hZGRyZXNzXCIpO1xyXG5cclxuICAgICAgICBsZXQgdHh0Q3VzdG9tZXJOYW1lID0gZmllbGRDdXN0b21lck5hbWUudmFsKCkudHJpbSgpO1xyXG4gICAgICAgIGxldCB0eHRDb250YWN0TnVtYmVyID0gZmllbGRDb250YWN0TnVtYmVyLnZhbCgpLnRyaW0oKTtcclxuICAgICAgICBsZXQgdHh0QWRkcmVzcyA9IGZpZWxkQWRkcmVzcy52YWwoKS50cmltKCk7XHJcblxyXG5cclxuICAgICAgICBjbGVhblRvYXN0Q29udGFpbmVyKCk7XHJcbiAgICAgICAgcmVzZXRJbnB1dEZpZWxkcygkKFwiI2NvbnRhaW5lcl9hZGRfYmlsbFwiKSk7XHJcblxyXG5cclxuICAgICAgICBsZXQgaXNWYWxpZCA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmICh0eHRDdXN0b21lck5hbWUgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgaXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBtYWtlSW5wdXRGaWVsZEludmFsaWQoZmllbGRDdXN0b21lck5hbWUpO1xyXG4gICAgICAgICAgICBzaG93QWxlcnRUb2FzdChcIkludmFsaWQgY3VzdG9tZXIgbmFtZVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0eHRDb250YWN0TnVtYmVyID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHNob3dJbmZvVG9hc3QoXCJBZGRpbmcgYSBjb250YWN0IG51bWJlciBjYW4gYmUgdXNlZnVsXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGlzVmFsaWQpIHtcclxuXHJcbiAgICAgICAgICAgICQucG9zdChgJHtnZXRTaXRlVXJsKCl9L2JpbGxzL2FkZC1hY3Rpb25gLCB7XHJcbiAgICAgICAgICAgICAgICBcImJpbGxfZGF0ZVwiOiBmaWVsZERhdGUudmFsKCksXHJcbiAgICAgICAgICAgICAgICBcImN1c3RvbWVyX25hbWVcIjogdHh0Q3VzdG9tZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgXCJjb250YWN0X251bWJlclwiOiB0eHRDb250YWN0TnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgXCJhZGRyZXNzXCI6IHR4dEFkZHJlc3MsXHJcbiAgICAgICAgICAgICAgICBcIml0ZW1zXCI6IGNob3Nlbkl0ZW1zXHJcbiAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG5cclxuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHNob3dBbGVydFRvYXN0KHJlc3BvbnNlLnJlc3BvbnNlSlNPTi5kYXRhKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcbn1cclxuXHJcblxyXG5sZXQgc2VsZWN0ZWRJdGVtcyA9IFtdO1xyXG5sZXQgY2hvc2VuSXRlbXMgPSB7fTtcclxuXHJcbiQoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIGxldCBkVFNlYXJjaEl0ZW1zID0gJChcIiNkdF9zZWFyY2hfYmlsbF9pdGVtc1wiKS5EYXRhVGFibGUoe1xyXG4gICAgICAgIFwiY29sdW1uRGVmc1wiOiBbXHJcbiAgICAgICAgICAgIHtjbGFzc05hbWU6IFwidGV4dC1yaWdodCBhbGlnbi1taWRkbGVcIiwgXCJ0YXJnZXRzXCI6IFwiX2FsbFwifVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgXCJvcmRlcmluZ1wiOiB0cnVlLFxyXG4gICAgICAgIFwib3JkZXJcIjogW11cclxuICAgIH0pO1xyXG5cclxuICAgIGxldCBkVEJpbGxJdGVtcyA9ICQoXCIjZHRfYmlsbF9pdGVtc1wiKS5EYXRhVGFibGUoe1xyXG4gICAgICAgIFwiY29sdW1uRGVmc1wiOiBbXHJcbiAgICAgICAgICAgIHtjbGFzc05hbWU6IFwidGV4dC1yaWdodCBhbGlnbi1taWRkbGVcIiwgXCJ0YXJnZXRzXCI6IFwiX2FsbFwifVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgXCJvcmRlcmluZ1wiOiB0cnVlLFxyXG4gICAgICAgIFwib3JkZXJcIjogW11cclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICBzaG93SXRlbVNlbGVjdE1vZGFsKCk7XHJcbiAgICBzZWFyY2hGb3JJdGVtcyhkVFNlYXJjaEl0ZW1zLCBkVEJpbGxJdGVtcyk7XHJcbiAgICBzYXZlQmlsbCgpO1xyXG59KTsiXX0=